{% extends 'express_partner/base.html' %}
{% block title %}درخواست همکاری - مرحله ۱{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-950">
  
  <!-- Header -->
  <header class="sticky top-0 z-50 bg-white/90 dark:bg-gray-900/90 backdrop-blur-md border-b border-gray-200 dark:border-gray-800 w-full">
    <div class="w-full px-4 h-14 flex items-center justify-between">
      <a href="{{ url_for('main.index') }}" class="w-9 h-9 grid place-items-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800">
        <i class="fas fa-times text-gray-500"></i>
      </a>
      <span class="text-sm font-bold text-gray-900 dark:text-white">درخواست همکاری</span>
      <span class="text-xs text-violet-600 dark:text-violet-400 font-semibold">۱/۳</span>
    </div>
    <!-- Progress Bar -->
    <div class="h-1 bg-gray-200 dark:bg-gray-800">
      <div class="h-full bg-violet-600 transition-all duration-300" style="width: 33%"></div>
    </div>
  </header>

  <main class="px-4 py-6 max-w-lg mx-auto">
    
    <!-- Title -->
    <div class="text-center mb-8">
      <div class="w-16 h-16 mx-auto mb-4 rounded-2xl bg-violet-100 dark:bg-violet-900/30 flex items-center justify-center">
        <i class="fas fa-user text-2xl text-violet-600 dark:text-violet-400"></i>
      </div>
      <h1 class="text-xl font-bold text-gray-900 dark:text-white">اطلاعات پایه</h1>
      <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">نام و شهر فعالیت خود را وارد کنید</p>
    </div>

    <!-- Current phone & edit link -->
    {% if session.get("user_phone") %}
    <div class="mb-6 flex items-center justify-between gap-3 text-xs text-gray-500 dark:text-gray-400">
      <div class="flex items-center gap-2">
        <i class="fas fa-phone text-gray-400"></i>
        <span>شماره ثبت‌شده: <span class="font-semibold text-gray-700 dark:text-gray-200">{{ session.get("user_phone") }}</span></span>
      </div>
      <form id="logoutApplyForm" method="post" action="{{ url_for('express_partner.logout') }}" class="m-0">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit"
                type="button"
                onclick="showLogoutConfirm('logoutApplyForm')"
                class="inline-flex items-center gap-1 px-2 py-1 rounded-full border border-gray-300 dark:border-gray-600 text-[11px] text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition">
          <i class="fas fa-pen"></i>
          ویرایش شماره
        </button>
      </form>
    </div>
    {% endif %}

    <!-- Form -->
    <form method="post" action="{{ url_for('express_partner.apply_step1') }}" class="space-y-4">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          نام و نام‌خانوادگی
        </label>
        <input type="text" name="name" value="{{ name }}" required
               placeholder="مثال: علی محمدی"
               class="w-full px-4 py-3.5 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
          شهر فعالیت
        </label>
        <select name="city" required
                class="w-full px-4 py-3.5 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-gray-900 dark:text-white focus:ring-2 focus:ring-violet-500 focus:border-transparent transition">
          <option value="">انتخاب شهر...</option>
          {% for c in cities %}
          <option value="{{ c }}" {% if city == c %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
      </div>

      <!-- Submit -->
      <div class="pt-4">
        <button type="submit" 
                class="w-full py-4 rounded-xl bg-violet-600 hover:bg-violet-700 text-white font-bold text-base transition flex items-center justify-center gap-2">
          مرحله بعد
          <i class="fas fa-arrow-left text-sm"></i>
        </button>
      </div>
    </form>

    <!-- Info -->
    <div class="mt-8 p-4 rounded-xl bg-violet-50 dark:bg-violet-900/20 border border-violet-100 dark:border-violet-800">
      <p class="text-sm text-violet-700 dark:text-violet-300 text-center">
        <i class="fas fa-shield-alt ml-2"></i>
        اطلاعات شما محرمانه است
      </p>
    </div>

  </main>
</div>

<!-- Logout Confirm Modal -->
<div id="logoutConfirmModal"
     class="fixed inset-0 z-50 hidden items-end sm:items-center justify-center">
  <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="hideLogoutConfirm()"></div>
  <div class="relative w-full sm:max-w-md mx-auto bg-white dark:bg-gray-900 rounded-t-2xl sm:rounded-2xl shadow-xl overflow-hidden">
    <div class="p-4 sm:p-5">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-full bg-rose-100 dark:bg-rose-900/40 text-rose-600 dark:text-rose-300 grid place-items-center">
          <i class="fas fa-sign-out-alt text-lg"></i>
        </div>
        <div>
          <p class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">خروج از حساب</p>
          <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">آیا از خروج اطمینان دارید؟</p>
        </div>
      </div>

      <div class="mt-5 grid grid-cols-1 sm:grid-cols-2 gap-3">
        <button type="button"
                class="w-full py-3 rounded-xl border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-200 font-semibold hover:bg-gray-50 dark:hover:bg-gray-800 transition"
                onclick="hideLogoutConfirm()">
          انصراف
        </button>
        <button type="button"
                class="w-full py-3 rounded-xl bg-rose-600 hover:bg-rose-700 text-white font-semibold transition"
                onclick="confirmLogout()">
          خروج
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const modal = document.getElementById('logoutConfirmModal');
    function disableScroll() { document.documentElement.classList.add('overflow-hidden'); document.body.classList.add('overflow-hidden'); }
    function enableScroll() { document.documentElement.classList.remove('overflow-hidden'); document.body.classList.remove('overflow-hidden'); }
    window.showLogoutConfirm = function(formId) {
      if (!modal) return;
      modal.dataset.targetForm = formId || '';
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      disableScroll();
    };
    window.hideLogoutConfirm = function() {
      if (!modal) return;
      modal.classList.add('hidden');
      modal.classList.remove('flex');
      enableScroll();
    };
    window.confirmLogout = function() {
      if (!modal) return;
      const formId = modal.dataset.targetForm;
      const form = formId ? document.getElementById(formId) : null;
      if (form) form.submit();
      hideLogoutConfirm();
    };
  })();
</script>

{% endblock %}
