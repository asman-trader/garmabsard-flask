{% extends 'express_partner/base.html' %}
{% block title %}آموزش - وینور اکسپرس{% endblock %}
{% block content %}
<div class="max-w-4xl mx-auto pt-0 px-3 sm:px-4 pb-20">
  
  <!-- Minimal sticky header -->
  <header class="sticky top-0 z-50 bg-white/95 dark:bg-gray-900/95 backdrop-blur border-b border-gray-200 dark:border-gray-800 -mx-3 px-3 sm:-mx-4 sm:px-4">
    <div class="max-w-4xl mx-auto h-14 flex items-center justify-between">
      <a href="{{ url_for('express_partner.dashboard') }}" class="w-9 h-9 grid place-items-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="بازگشت">
        <i class="fas fa-arrow-right"></i>
      </a>
      <h1 class="text-sm sm:text-base font-bold text-gray-900 dark:text-white">آموزش</h1>
      <div class="w-9"></div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="mt-6 space-y-6">
    
    <!-- Video Section -->
    {% if training_video_url %}
    <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700">
      <div class="aspect-video bg-black">
        {% if 'youtube.com' in training_video_url or 'youtu.be' in training_video_url %}
          {# YouTube Embed #}
          {% if '/embed/' in training_video_url %}
            {# Already an embed URL #}
            <iframe src="{{ training_video_url }}" 
                    class="w-full h-full" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen></iframe>
          {% elif 'youtu.be/' in training_video_url %}
            {# Short URL format: youtu.be/VIDEO_ID #}
            {% set video_id = training_video_url.split('youtu.be/')[-1].split('?')[0] %}
            <iframe src="https://www.youtube.com/embed/{{ video_id }}" 
                    class="w-full h-full" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen></iframe>
          {% elif 'watch?v=' in training_video_url %}
            {# Standard URL format: youtube.com/watch?v=VIDEO_ID #}
            {% set video_id = training_video_url.split('watch?v=')[-1].split('&')[0] %}
            <iframe src="https://www.youtube.com/embed/{{ video_id }}" 
                    class="w-full h-full" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen></iframe>
          {% else %}
            {# Fallback: try to extract from URL #}
            {% set video_id = training_video_url.split('/')[-1].split('?')[0] %}
            <iframe src="https://www.youtube.com/embed/{{ video_id }}" 
                    class="w-full h-full" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen></iframe>
          {% endif %}
        {% else %}
          {# Direct Video File #}
          <video class="w-full h-full" controls>
            <source src="{{ training_video_url }}" type="video/mp4">
            مرورگر شما از پخش ویدئو پشتیبانی نمی‌کند.
          </video>
        {% endif %}
      </div>
    </div>
    {% else %}
    <!-- Placeholder when no video URL is set -->
    <div class="bg-white dark:bg-gray-800 rounded-xl overflow-hidden border border-gray-200 dark:border-gray-700">
      <div class="aspect-video bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900/30 dark:to-indigo-900/30 flex items-center justify-center">
        <div class="text-center space-y-3">
          <div class="w-20 h-20 mx-auto rounded-full bg-blue-200 dark:bg-blue-800 flex items-center justify-center">
            <i class="fas fa-video text-blue-600 dark:text-blue-400 text-3xl"></i>
          </div>
          <p class="text-sm text-gray-600 dark:text-gray-400">ویدئو آموزش به زودی اضافه می‌شود</p>
        </div>
      </div>
    </div>
    {% endif %}

    <!-- Introduction -->
    <div class="text-center space-y-2">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white">راهنمای همکاری</h2>
      <p class="text-sm text-gray-600 dark:text-gray-400">آموزش‌های ضروری برای همکاران اکسپرس</p>
    </div>

    <!-- Training Sections -->
    <div class="space-y-4">
      
      <!-- Section 1 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700">
        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
          <i class="fas fa-file-alt text-blue-600 dark:text-blue-400"></i>
          معرفی فایل‌ها به مشتریان
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">
          فایل‌های اختصاص یافته را با دقت بررسی کنید و اطلاعات کامل را به مشتریان ارائه دهید. از لینک اشتراک‌گذاری برای ارسال مستقیم استفاده کنید.
        </p>
      </div>

      <!-- Section 2 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700">
        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
          <i class="fas fa-calculator text-blue-600 dark:text-blue-400"></i>
          محاسبه پورسانت
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">
          پورسانت شما بر اساس درصد تعیین شده از قیمت کل معامله محاسبه می‌شود. درصد پورسانت در کارت هر فایل نمایش داده می‌شود.
        </p>
      </div>

      <!-- Section 3 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700">
        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
          <i class="fas fa-handshake text-blue-600 dark:text-blue-400"></i>
          ثبت معامله
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">
          پس از توافق با مشتری، وضعیت فایل را به «در حال معامله» تغییر دهید. پس از تکمیل معامله، اطلاعات را در بخش کمیسیون‌ها ثبت کنید.
        </p>
      </div>

      <!-- Section 4 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl p-5 border border-gray-200 dark:border-gray-700">
        <h3 class="text-base font-bold text-gray-900 dark:text-white mb-3 flex items-center gap-2">
          <i class="fas fa-gavel text-blue-600 dark:text-blue-400"></i>
          قوانین و مقررات
        </h3>
        <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">
          رعایت اصول اخلاقی و قوانین معاملات ملکی الزامی است. اطلاعات ارائه شده باید دقیق و به‌روز باشد.
        </p>
      </div>

    </div>

    <!-- Support Link -->
    <div class="pt-4">
      <a href="{{ url_for('express_partner.support') }}" 
         class="block bg-white dark:bg-gray-800 rounded-xl p-4 border border-gray-200 dark:border-gray-700 hover:border-blue-500 transition-colors">
        <div class="flex items-center gap-3">
          <i class="fas fa-headset text-blue-600 dark:text-blue-400 text-xl"></i>
          <div class="text-right flex-1">
            <p class="font-semibold text-gray-900 dark:text-white">نیاز به کمک دارید؟</p>
            <p class="text-xs text-gray-500 dark:text-gray-400">تماس با پشتیبانی</p>
          </div>
          <i class="fas fa-arrow-left text-gray-400"></i>
        </div>
      </a>
    </div>

  </div>

  {% set bottom_nav_active = '' %}
  {% include 'express_partner/partials/bottom_nav.html' %}

</div>
{% endblock %}

