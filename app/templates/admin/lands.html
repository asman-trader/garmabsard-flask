{% extends 'admin/base_admin.html' %}

{% block content %}
<div class="max-w-6xl mx-auto p-4 sm:p-6">

  <!-- Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ù‡ -->
  <h1 class="text-xl sm:text-2xl font-bold text-vinor-700 dark:text-vinor-600 mb-6 flex items-center gap-2">
    <i class="fas fa-layer-group"></i>
    Ù„ÛŒØ³Øª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡
  </h1>

  <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
  {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="mb-4 text-sm rounded-lg px-3 py-2
                    {% if category in ['success'] %}bg-green-50 text-green-700 dark:bg-green-900/40 dark:text-green-200
                    {% elif category in ['warning'] %}bg-yellow-50 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-200
                    {% elif category in ['info'] %}bg-blue-50 text-blue-700 dark:bg-blue-900/40 dark:text-blue-200
                    {% else %}bg-red-50 text-red-700 dark:bg-red-900/40 dark:text-red-200{% endif %}">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- Ù„ÛŒØ³Øª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6">
    {% for land in lands %}
      <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl shadow p-4 flex flex-col justify-between">

        <!-- ØªØµÙˆÛŒØ± Ù…Ù„Ú© -->
        {% set cover = (land.images[0] if land.images and land.images|length > 0 else None) %}
        {% if cover %}
          <img src="{{ url_for('static', filename=cover) }}"
               alt="ØªØµÙˆÛŒØ± Ù…Ù„Ú©"
               class="w-full h-40 object-cover rounded-xl mb-3">
        {% else %}
          <div class="w-full h-40 bg-gray-100 dark:bg-gray-700 rounded-xl mb-3 flex items-center justify-center text-gray-400">
            Ø¨Ø¯ÙˆÙ† ØªØµÙˆÛŒØ±
          </div>
        {% endif %}

        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ù„Ú© -->
        <div>
          <h2 class="text-base sm:text-lg font-bold text-gray-800 dark:text-gray-100">
            {{ land.title or 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†' }}
          </h2>
          <p class="text-sm mt-1 text-gray-600 dark:text-gray-300">ğŸ“ Ù…ØªØ±Ø§Ú˜: {{ land.size }} Ù…ØªØ±</p>
          <p class="text-sm text-gray-600 dark:text-gray-300">ğŸ“ Ù…ÙˆÙ‚Ø¹ÛŒØª: {{ land.location }}</p>
          {% if land.code %}
            <p class="text-xs mt-1 text-gray-500 dark:text-gray-400">ğŸ†” Ú©Ø¯ Ù…Ù„Ú©: {{ land.code }}</p>
          {% endif %}
          {% if land.description %}
            <p class="text-sm mt-2 text-gray-700 dark:text-gray-300 line-clamp-3">ğŸ“ {{ land.description }}</p>
          {% endif %}
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
        <div class="mt-4 flex gap-2">
          <a href="{{ url_for('admin.edit_land', land_id=loop.index0) }}"
             class="flex-1 inline-flex items-center justify-center gap-1.5 bg-vinor-600 hover:bg-vinor-700 text-white text-sm py-2 rounded-lg transition">
            <i class="fas fa-edit"></i>
            ÙˆÛŒØ±Ø§ÛŒØ´
          </a>

          <!-- Ø­Ø°Ù: POST + CSRF -->
          <form method="post" action="{{ url_for('admin.delete_land', land_id=loop.index0) }}" class="flex-1"
                onsubmit="return confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¢Ú¯Ù‡ÛŒ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit"
                    class="w-full inline-flex items-center justify-center gap-1.5 bg-rose-600 hover:bg-rose-700 text-white text-sm py-2 rounded-lg transition">
              <i class="fas fa-trash"></i>
              Ø­Ø°Ù
            </button>
          </form>
        </div>
      </div>
    {% else %}
      <p class="text-center text-gray-500 dark:text-gray-400 col-span-1 md:col-span-2 lg:col-span-3">
        Ù‡ÛŒÚ† Ø¢Ú¯Ù‡ÛŒâ€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.
      </p>
    {% endfor %}
  </div>

  <!-- Ø¨Ø§Ø²Ú¯Ø´Øª -->
  <div class="mt-8 text-center">
    <a href="{{ url_for('admin.dashboard') }}" class="inline-flex items-center gap-2 text-vinor-700 dark:text-vinor-600 hover:underline">
      <i class="fas fa-arrow-right"></i>
      Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
    </a>
  </div>

</div>
{% endblock %}
