{% extends 'base.html' %}
{% set hide_header = True %}

{% block title %}تنظیمات | وینور{% endblock %}

{% block content %}
<!-- ظرف اصلی (Mobile-First) -->
<div class="mx-auto max-w-xl px-4 pb-28 pt-3 sm:pt-6">

  <!-- Header: back + title + icon (like favorites) -->
  <header class="fixed top-0 inset-x-0 z-30 bg-white dark:bg-gray-800 border-b dark:border-gray-700">
    <div class="max-w-xl mx-auto px-3 sm:px-4 py-3 flex items-center justify-between">
      <button type="button" onclick="history.back()" class="w-9 h-9 grid place-items-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="بازگشت">
        <i class="fas fa-arrow-right"></i>
      </button>
      <h1 class="text-base sm:text-lg font-bold text-gray-900 dark:text-white">تنظیمات</h1>
      <button type="button" class="w-9 h-9 grid place-items-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-700" aria-label="تنظیمات">
        <i class="fas fa-gear"></i>
      </button>
    </div>
  </header>
  <div class="h-20"></div>

  <!-- نمایش جستجوی سریع -->
  <section class="rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
    <div class="px-4 pt-4 pb-2 text-xs font-bold text-gray-500 dark:text-gray-400">جستجو</div>
    <div class="px-4 pb-4 flex items-center justify-between gap-3">
      <div>
        <div class="text-sm font-semibold">نمایش جستجوی سریع در خانه</div>
        <div class="text-xs text-gray-500 dark:text-gray-400">نوار جستجوی سریع در صفحه اصلی</div>
      </div>
      <label class="inline-flex items-center cursor-pointer">
        <input id="toggleQuickSearch" type="checkbox" class="sr-only">
        <span class="w-10 h-6 bg-gray-300 dark:bg-gray-700 rounded-full relative">
          <span class="dot absolute top-1 right-1 w-4 h-4 bg-white rounded-full transition"></span>
        </span>
      </label>
    </div>
  </section>

  <!-- نمایش منوی کناری (سایدبار) -->
  <section class="mt-4 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
    <div class="px-4 pt-4 pb-2 text-xs font-bold text-gray-500 dark:text-gray-400">ناوبری</div>
    <div class="px-4 pb-4 flex items-center justify-between gap-3">
      <div>
        <div class="text-sm font-semibold">نمایش منوی کناری</div>
        <div class="text-xs text-gray-500 dark:text-gray-400">دکمه سه‌خط و پنل سایدبار قابل نمایش/پنهان</div>
      </div>
      <label class="inline-flex items-center cursor-pointer">
        <input id="toggleSidebar" type="checkbox" class="sr-only">
        <span class="w-10 h-6 bg-gray-300 dark:bg-gray-700 rounded-full relative">
          <span class="dot absolute top-1 right-1 w-4 h-4 bg-white rounded-full transition"></span>
        </span>
      </label>
    </div>
  </section>

  <!-- نمایش دکمه + ثبت آگهی -->
  <section class="mt-4 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
    <div class="px-4 pt-4 pb-2 text-xs font-bold text-gray-500 dark:text-gray-400">میانبرها</div>
    <div class="px-4 pb-4 flex items-center justify-between gap-3">
      <div>
        <div class="text-sm font-semibold">نمایش دکمه + ثبت آگهی</div>
        <div class="text-xs text-gray-500 dark:text-gray-400">دکمه شناور (موبایل) و میانبر هدر</div>
      </div>
      <label class="inline-flex items-center cursor-pointer">
        <input id="toggleSubmitBtn" type="checkbox" class="sr-only">
        <span class="w-10 h-6 bg-gray-300 dark:bg-gray-700 rounded-full relative">
          <span class="dot absolute top-1 right-1 w-4 h-4 bg-white rounded-full transition"></span>
        </span>
      </label>
    </div>
  </section>

  <!-- حالت نمایش (تیره/روشن) -->
  <section class="mt-4 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
    <div class="px-4 pt-4 pb-2 text-xs font-bold text-gray-500 dark:text-gray-400">نمایش</div>
    <div class="px-4 pb-4 flex items-center justify-between gap-3">
      <div>
        <div class="text-sm font-semibold">حالت تیره</div>
        <div class="text-xs text-gray-500 dark:text-gray-400">روشن/تیره (برای کل اپ)</div>
      </div>
      <label class="inline-flex items-center cursor-pointer">
        <input id="toggleDarkMode" type="checkbox" class="sr-only">
        <span class="w-10 h-6 bg-gray-300 dark:bg-gray-700 rounded-full relative">
          <span class="dot absolute top-1 right-1 w-4 h-4 bg-white rounded-full transition"></span>
        </span>
      </label>
    </div>
  </section>

  <!-- حریم‌خصوصی و امنیت -->
  <section class="mt-4 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
    <div class="px-4 pt-4 pb-2 text-xs font-bold text-gray-500 dark:text-gray-400">حساب</div>
    <div class="px-4 pb-4 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-full bg-yellow-100 dark:bg-yellow-900/30 grid place-items-center text-yellow-700 dark:text-yellow-300"><i class="fas fa-shield-alt"></i></div>
        <div>
          <div class="text-sm font-semibold">حریم‌خصوصی و امنیت</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">ورود با پیامک؛ مدیریت مجوزها و امنیت حساب</div>
        </div>
      </div>
    </div>
  </section>

  <!-- نشست‌ها و دستگاه‌ها -->
  <section class="mt-4 rounded-2xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm overflow-hidden">
    <div class="px-4 pb-4 flex items-center justify-between gap-3">
      <div class="flex items-center gap-3">
        <div class="w-9 h-9 rounded-full bg-orange-100 dark:bg-orange-900/30 grid place-items-center text-orange-700 dark:text-orange-300"><i class="fas fa-laptop"></i></div>
        <div>
          <div class="text-sm font-semibold">نشست‌ها و دستگاه‌ها</div>
          <div class="text-xs text-gray-500 dark:text-gray-400">در صورت نیاز از همه دستگاه‌ها خارج شوید</div>
        </div>
      </div>
      <a href="{{ url_for('main.logout') }}" class="px-3 py-2 rounded-lg bg-red-600 text-white text-sm hover:bg-red-700">خروج از حساب</a>
    </div>
  </section>
</div>

<!-- JS: تنظیم جستجوی سریع -->
<script>
  (function(){
    const quick = document.getElementById('toggleQuickSearch');
    try {
      const qs = localStorage.getItem('vinor_show_quick_search');
      const on = qs ? qs==='1' : true; // پیش‌فرض: نمایش فعال باشد
      if (quick){ quick.checked = !!on; moveDotQS(); }
    } catch {}

    function moveDotQS(){
      const dot = document.querySelector('#toggleQuickSearch + span .dot');
      if (!dot || !quick) return;
      dot.style.right = quick.checked ? '1.5rem' : '0.25rem';
    }

    quick?.addEventListener('change', ()=>{
      try{ localStorage.setItem('vinor_show_quick_search', quick.checked ? '1' : '0'); }catch{}
      moveDotQS();
      // اطلاع به صفحه اصلی برای پنهان/نمایش
      try{ window.dispatchEvent(new CustomEvent('vinor:qs-toggle', { detail: quick.checked })); }catch{}
    });
  })();
</script>

<!-- JS: حالت تیره/روشن -->
<script>
  (function(){
    const root = document.documentElement;
    const el = document.getElementById('toggleDarkMode');
    try {
      const saved = localStorage.getItem('theme');
      const isDark = saved ? saved==='dark' : root.classList.contains('dark');
      if (el){ el.checked = !!isDark; moveDotDM(); }
    } catch {}

    function moveDotDM(){
      const dot = document.querySelector('#toggleDarkMode + span .dot');
      if (!dot || !el) return;
      dot.style.right = el.checked ? '1.5rem' : '0.25rem';
    }

    el?.addEventListener('change', ()=>{
      root.classList.toggle('dark');
      try{ localStorage.setItem('theme', root.classList.contains('dark')?'dark':'light'); }catch{}
      moveDotDM();
      // به‌روزرسانی meta theme-color مطابق base.html
      try{
        const meta = document.querySelector('meta[name="theme-color"]');
        if (meta) meta.setAttribute('content', root.classList.contains('dark') ? '#111827' : '#16a34a');
      }catch{}
    });
  })();
</script>

<!-- JS: تنظیم سایدبار کاربر -->
<script>
  (function(){
    const el = document.getElementById('toggleSidebar');
    try {
      const v = localStorage.getItem('vinor_show_sidebar');
      const on = v ? v==='1' : true; // پیش‌فرض: نمایش فعال
      if (el){ el.checked = !!on; moveDotSB(); }
    } catch {}

    function moveDotSB(){
      const dot = document.querySelector('#toggleSidebar + span .dot');
      if (!dot || !el) return;
      dot.style.right = el.checked ? '1.5rem' : '0.25rem';
    }

    el?.addEventListener('change', ()=>{
      try{ localStorage.setItem('vinor_show_sidebar', el.checked ? '1' : '0'); }catch{}
      moveDotSB();
      // اطلاع به صفحات برای اعمال فوری (اختیاری)
      try{ window.dispatchEvent(new CustomEvent('vinor:sidebar-toggle', { detail: el.checked })); }catch{}
    });
  })();
</script>

<!-- JS: تنظیم دکمه + ثبت آگهی -->
<script>
  (function(){
    const el = document.getElementById('toggleSubmitBtn');
    try {
      const v = localStorage.getItem('vinor_show_submit_btn');
      const on = v ? v==='1' : true; // پیش‌فرض: نمایش فعال
      if (el){ el.checked = !!on; moveDot(); }
    } catch {}

    function moveDot(){
      const dot = document.querySelector('#toggleSubmitBtn + span .dot');
      if (!dot || !el) return;
      dot.style.right = el.checked ? '1.5rem' : '0.25rem';
    }

    el?.addEventListener('change', ()=>{
      try{ localStorage.setItem('vinor_show_submit_btn', el.checked ? '1' : '0'); }catch{}
      moveDot();
      // اطلاع به صفحات برای اعمال فوری
      try{ window.dispatchEvent(new CustomEvent('vinor:submit-btn-toggle', { detail: el.checked })); }catch{}
    });
  })();
</script>
{% endblock %}
