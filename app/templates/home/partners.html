{% extends 'base.html' %}

{% block title %}همکاری با وینور | VINOR{% endblock %}

{% block head %}
  <meta name="description" content="همکاری با وینور در زمینه ملک - فرصت همکاری برای مشاوران املاک" />
  <meta name="theme-color" content="#2563EB">
  <link rel="canonical" href="{{ request.url_root.rstrip('/') }}">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="همکاری با وینور | VINOR">
  <meta property="og:description" content="همکاری با وینور در زمینه ملک - فرصت همکاری برای مشاوران املاک">
  <meta property="og:url" content="{{ request.url }}">

  <style>
    .focusable:focus{outline:2px solid #2563EB;outline-offset:2px}
  </style>
{% endblock %}

{% block content %}
  {# Header مخصوص لندینگ - سبک دیوار #}
  <header class="fixed top-0 left-0 right-0 z-50 bg-white dark:bg-gray-950 border-b border-gray-200 dark:border-gray-800">
    <div class="max-w-5xl mx-auto px-4 h-14 flex items-center justify-between">
      <a href="{{ url_for('main.index') }}" class="flex items-center gap-2" aria-label="وینور">
        <span class="text-lg font-extrabold text-green-600 dark:text-green-400">وینور</span>
        <span class="text-[11px] text-gray-500 dark:text-gray-400 hidden xs:inline">
          همکاری در حوزه ملک
        </span>
      </a>
      <div class="flex items-center gap-2">
        <a href="{{ url_for('main.express_public_list') }}"
           class="flex items-center gap-1 text-xs font-medium text-gray-700 dark:text-gray-200 px-3 py-1.5 rounded-full border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 transition">
          <i class="fa-solid fa-magnifying-glass text-[11px]"></i>
          <span>اکسپلور</span>
        </a>
        <a href="{{ url_for('express_partner.login') }}"
           class="flex items-center gap-1 text-xs font-medium text-blue-600 dark:text-blue-400 px-3 py-1.5 rounded-full border border-blue-200 dark:border-blue-500/40 bg-blue-50 dark:bg-blue-500/10 hover:bg-blue-100 dark:hover:bg-blue-500/20 transition">
          <i class="fa-solid fa-user text-[11px]"></i>
          <span>ورود همکار</span>
        </a>
      </div>
    </div>
  </header>

  {# محتوای اصلی لندینگ #}
  <div class="max-w-5xl mx-auto pt-16 px-4 pb-16 space-y-6">

    <!-- Hero - سبک دیوار، مینیمال -->
    <section class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 sm:p-5">
      <div class="flex items-start sm:items-center justify-between gap-3">
        <div class="space-y-1">
          <h1 class="text-xl sm:text-2xl font-extrabold text-gray-900 dark:text-white">وینور</h1>
          <p class="text-sm text-gray-600 dark:text-gray-400 leading-relaxed">
            وینور، پلتفرم ساده و سریع برای معرفی و معامله ملک؛
            با تمرکز بر شفافیت، سرعت و تجربه‌ای شبیه دیوار اما اختصاصی حوزه املاک.
          </p>
        </div>
        {% if android_apk_url %}
        <a href="{{ android_apk_url }}" download rel="noopener"
           class="hidden sm:inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm">
          <i class="fa-solid fa-download"></i>
          دانلود اندروید
        </a>
        {% endif %}
      </div>
      <div class="mt-3 flex flex-wrap items-center gap-2">
        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-[11px] text-gray-700 dark:text-gray-300">
          <i class="fa-solid fa-bolt"></i> سریع و سبک
        </span>
        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-[11px] text-gray-700 dark:text-gray-300">
          <i class="fa-solid fa-shield-halved"></i> شفاف و امن
        </span>
        <span class="inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-[11px] text-gray-700 dark:text-gray-300">
          <i class="fa-solid fa-mobile-screen"></i> نصب به‌صورت PWA
        </span>
      </div>
      {% if android_apk_url %}
      <div class="mt-3 sm:hidden">
        <a href="{{ android_apk_url }}" download rel="noopener"
           class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm">
          <i class="fa-solid fa-download"></i>
          دانلود اندروید
        </a>
      </div>
      {% endif %}
    </section>

    <!-- Features - سبک دیوار -->
    <section class="grid sm:grid-cols-3 gap-3">
      <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <div class="w-10 h-10 rounded-lg bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 grid place-items-center">
            <i class="fa-solid fa-list-check"></i>
          </div>
          <div>
            <div class="text-sm font-bold text-gray-900 dark:text-white">فایل‌های تأییدشده</div>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">مشاهده و همکاری روی فایل‌هایی که بررسی اولیه شده‌اند.</p>
          </div>
        </div>
      </div>
      <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <div class="w-10 h-10 rounded-lg bg-emerald-50 dark:bg-emerald-900/30 text-emerald-600 dark:text-emerald-400 grid place-items-center">
            <i class="fa-solid fa-money-bill-trend-up"></i>
          </div>
          <div>
            <div class="text-sm font-bold text-gray-900 dark:text-white">پورسانت شفاف</div>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">ثبت و پیگیری پورسانت‌ها به‌صورت درون‌برنامه‌ای.</p>
          </div>
        </div>
      </div>
      <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <div class="flex items-start gap-3">
          <div class="w-10 h-10 rounded-lg bg-purple-50 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 grid place-items-center">
            <i class="fa-solid fa-bolt"></i>
          </div>
          <div>
            <div class="text-sm font-bold text-gray-900 dark:text-white">تجربه سریع</div>
            <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">رابط کاربری سبک با الگوی دیوار برای کار روزمره.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Install Card - Divar Style -->
    <div id="expressPartnerInstallHero" class="hidden">
      <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
        <div class="flex items-center gap-3 mb-4">
          <div class="w-10 h-10 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center flex-shrink-0">
            <i class="fa-solid fa-download text-gray-600 dark:text-gray-400"></i>
          </div>
          <div>
            <h2 class="font-semibold text-sm text-gray-900 dark:text-white">نصب پنل همکاران</h2>
            <p class="text-xs text-gray-500 dark:text-gray-400">برای دسترسی سریع‌تر</p>
          </div>
        </div>
        <button id="expressPartnerInstallHeroBtn" class="w-full px-4 py-2.5 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white font-medium rounded-lg hover:border-gray-400 dark:hover:border-gray-500 transition flex items-center justify-center gap-2">
          <i class="fa-solid fa-download text-sm"></i>
          <span>نصب اپلیکیشن</span>
        </button>
        <!-- Mobile Install Instructions -->
        <div id="mobileInstallInstructions" class="hidden mt-4 space-y-3 text-xs text-gray-600 dark:text-gray-400">
          <div id="iosInstructions" class="hidden bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2.5 space-y-2">
            <div class="font-medium flex items-center gap-2 text-gray-900 dark:text-white">
              <i class="fa-brands fa-apple"></i>
              <span>نصب در iOS (سافاری):</span>
            </div>
            <ol class="list-decimal list-inside space-y-1 pr-2">
              <li>روی دکمه <i class="fa-solid fa-share"></i> در پایین صفحه ضربه بزنید</li>
              <li>گزینه «به صفحه اصلی اضافه کن» را انتخاب کنید</li>
              <li>روی «اضافه کردن» ضربه بزنید</li>
            </ol>
          </div>
          <div id="androidInstructions" class="hidden bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2.5 space-y-2">
            <div class="font-medium flex items-center gap-2 text-gray-900 dark:text-white">
              <i class="fa-brands fa-android"></i>
              <span>نصب در اندروید:</span>
            </div>
            <ol class="list-decimal list-inside space-y-1 pr-2">
              <li>روی منوی سه نقطه <i class="fa-solid fa-ellipsis-vertical"></i> در مرورگر ضربه بزنید</li>
              <li>گزینه «نصب اپ» یا «Add to Home screen» را انتخاب کنید</li>
              <li>روی «نصب» یا «Install» ضربه بزنید</li>
            </ol>
          </div>
        </div>
        <p id="expressPartnerInstallHint" class="hidden text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg px-3 py-2 mt-4">
          مرورگر شما نصب مستقیم را پشتیبانی نمی‌کند. از منوی مرورگر گزینه «Add to Home Screen» را انتخاب کنید.
        </p>
      </div>
    </div>

    <!-- Login Card - Divar Style -->
    <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 space-y-4">
    {% if android_apk_url %}
    <!-- Android Direct Download - Divar Style -->
    <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3 mb-2">
      <div class="flex items-center justify-between gap-3">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-lg bg-green-100 dark:bg-green-900/40 flex items-center justify-center">
            <i class="fa-brands fa-android text-green-700 dark:text-green-300"></i>
          </div>
          <div>
            <div class="text-sm font-bold text-gray-900 dark:text-white">دانلود مستقیم اپ اندروید وینور</div>
            <div class="text-[11px] text-gray-600 dark:text-gray-400">نسخه {{ android_apk_version or '—' }}</div>
          </div>
        </div>
        <a href="{{ android_apk_url }}" download rel="noopener"
           class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-green-600 hover:bg-green-700 text-white text-sm">
          <i class="fa-solid fa-download"></i>
          دانلود
        </a>
      </div>
    </div>
    {% endif %}
      <div class="text-center space-y-1">
        <h2 class="font-semibold text-base text-gray-900 dark:text-white">ورود به پنل</h2>
        <p class="text-xs text-gray-500 dark:text-gray-400">
          اگر همکار اکسپرس هستید، وارد شوید
        </p>
      </div>
      
      <div>
        <a href="{{ url_for('express_partner.login') }}" class="w-full px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors focusable inline-flex items-center justify-center gap-2">
          <i class="fa-solid fa-right-to-bracket text-sm"></i>
          <span>ورود به پنل</span>
        </a>
      </div>

      <!-- PWA Install Button (Alternative) -->
      <div id="expressPartnerInstallLanding" class="hidden">
        <button id="expressPartnerInstallLandingBtn" class="w-full px-4 py-2.5 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 hover:border-gray-400 dark:hover:border-gray-500 text-gray-900 dark:text-white font-medium rounded-lg transition-colors focusable inline-flex items-center justify-center gap-2">
          <i class="fa-solid fa-download text-sm"></i>
          <span>نصب اپلیکیشن</span>
        </button>
      </div>
    </div>

    <!-- About (Compact) - Divar Style -->
    <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4">
      <div class="flex items-start gap-3">
        <div class="w-10 h-10 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center flex-shrink-0">
          <i class="fa-solid fa-handshake text-gray-600 dark:text-gray-400"></i>
        </div>
        <p class="text-sm text-gray-700 dark:text-gray-300 leading-relaxed">
          وینور با استانداردهای تجربه‌کاربری دیوار، فرآیند معرفی و معامله ملک را ساده می‌کند.
          اگر فعال حوزه املاک هستید، با «همکاری اکسپرس» فایل‌های تأییدشده دریافت می‌کنید و
          پس از فروش، کمیسیون شفاف و قابل‌پیگیری دریافت می‌کنید.
        </p>
      </div>
    </div>

    <!-- FAQ - سبک دیوار -->
    <section class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-3 sm:p-4 space-y-2">
      <h2 class="text-sm font-bold text-gray-900 dark:text-white mb-1">سوالات پرتکرار</h2>
      <details class="group border border-gray-200 dark:border-gray-700 rounded-lg p-3">
        <summary class="flex items-center justify-between cursor-pointer list-none">
          <span class="text-sm text-gray-800 dark:text-gray-100">چطور همکار اکسپرس شوم؟</span>
          <i class="fa-solid fa-chevron-left text-gray-400 group-open:rotate-90 transition-transform"></i>
        </summary>
        <div class="mt-2 text-xs text-gray-600 dark:text-gray-400">از بخش «درخواست همکاری» ثبت‌نام کنید و پس از تأیید وارد پنل شوید.</div>
      </details>
      <details class="group border border-gray-200 dark:border-gray-700 rounded-lg p-3">
        <summary class="flex items-center justify-between cursor-pointer list-none">
          <span class="text-sm text-gray-800 dark:text-gray-100">پورسانت‌ها چگونه محاسبه می‌شود؟</span>
          <i class="fa-solid fa-chevron-left text-gray-400 group-open:rotate-90 transition-transform"></i>
        </summary>
        <div class="mt-2 text-xs text-gray-600 dark:text-gray-400">پس از ثبت معامله و تأیید پشتیبانی، پورسانت طبق درصد تعیین‌شده قابل مشاهده است.</div>
      </details>
    </section>

    <!-- Apply Link - Divar Style -->
    <div class="text-center">
      <p class="text-sm text-gray-500 dark:text-gray-400 mb-2">
        هنوز همکار اکسپرس نیستید؟
      </p>
      <a href="{{ url_for('express_partner.apply') }}" class="inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 font-medium focusable text-sm transition">
        <span>درخواست همکاری</span>
        <i class="fa-solid fa-arrow-left text-xs"></i>
      </a>
    </div>

    <!-- Info Badge - Divar Style -->
    <div class="text-center">
      <span class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-400 text-xs font-medium">
        <i class="fa-solid fa-info-circle"></i>
        <span>همکاری فقط در زمینه ملک فعال است</span>
      </span>
    </div>

  </div>

  {# Spacer removed: no bottom nav on landing #}
{% endblock %}

{% block footer %}{% endblock %}

{% block scripts %}
  <script>
    // --- Dark Mode ---
    const root = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') root.classList.remove('dark');
    document.getElementById('darkToggle')?.addEventListener('click', () => {
      root.classList.toggle('dark');
      localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
      const icon = document.querySelector('#darkToggle i');
      if (icon) {
        icon.className = root.classList.contains('dark') ? 'fa-solid fa-sun' : 'fa-solid fa-moon';
      }
    });
    // Update icon on load
    if (savedTheme === 'light') {
      const icon = document.querySelector('#darkToggle i');
      if (icon) icon.className = 'fa-solid fa-sun';
    }

    // --- Express Partner PWA Install Hooks ---
    let expressPartnerDeferredPrompt;

    // Detect mobile platform
    function detectMobilePlatform() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        return 'ios';
      }
      if (/android/i.test(userAgent)) {
        return 'android';
      }
      return 'other';
    }

    // Show mobile install instructions
    function showMobileInstallInstructions() {
      const platform = detectMobilePlatform();
      const instructionsDiv = document.getElementById('mobileInstallInstructions');
      const iosInstructions = document.getElementById('iosInstructions');
      const androidInstructions = document.getElementById('androidInstructions');
      
      if (instructionsDiv) {
        instructionsDiv.classList.remove('hidden');
        if (platform === 'ios' && iosInstructions) {
          iosInstructions.classList.remove('hidden');
        } else if (platform === 'android' && androidInstructions) {
          androidInstructions.classList.remove('hidden');
        }
      }
    }

    // Handle PWA install prompt for Express Partner
    window.addEventListener('beforeinstallprompt', (e) => {
      const url = new URL(window.location.href);
      if (['/', '/partners'].includes(url.pathname) || url.pathname.startsWith('/express/partner/')) {
        e.preventDefault();
        expressPartnerDeferredPrompt = e;

        // Show install buttons when PWA is available
        const installBtnContainer = document.getElementById('expressPartnerInstallLanding');
        const installHeroContainer = document.getElementById('expressPartnerInstallHero');
        if (installBtnContainer) {
          installBtnContainer.classList.remove('hidden');
        }
        if (installHeroContainer) {
          installHeroContainer.classList.remove('hidden');
        }
      }
    });

    // Show mobile install instructions on mobile devices if PWA install is not available
    document.addEventListener('DOMContentLoaded', function() {
      const platform = detectMobilePlatform();
      const installHeroContainer = document.getElementById('expressPartnerInstallHero');
      
      // If on mobile and no install prompt available, show instructions after a delay
      if ((platform === 'ios' || platform === 'android') && !expressPartnerDeferredPrompt) {
        setTimeout(() => {
          if (installHeroContainer && installHeroContainer.classList.contains('hidden')) {
            // Show install card with mobile instructions
            installHeroContainer.classList.remove('hidden');
            showMobileInstallInstructions();
            // Hide the install button and show instructions directly
            const installBtn = document.getElementById('expressPartnerInstallHeroBtn');
            if (installBtn) {
              installBtn.style.display = 'none';
            }
          }
        }, 1000);
      }
    });

    // Handle successful installation
    window.addEventListener('appinstalled', (evt) => {
      console.log('Express Partner PWA was installed successfully');
      expressPartnerDeferredPrompt = null;

      // Update install buttons after successful install
      const installBtn = document.getElementById('expressPartnerInstallLandingBtn');
      const installHeroBtn = document.getElementById('expressPartnerInstallHeroBtn');
      if (installBtn) {
        installBtn.innerHTML = '<i class="fa-solid fa-check text-sm"></i> <span>نصب شد</span>';
        installBtn.disabled = true;
        installBtn.classList.add('opacity-50', 'cursor-not-allowed');
      }
      if (installHeroBtn) {
        installHeroBtn.innerHTML = '<i class="fa-solid fa-check text-sm"></i> <span>نصب شد</span>';
        installHeroBtn.disabled = true;
        installHeroBtn.classList.add('opacity-50', 'cursor-not-allowed');
      }
    });

    // PWA Install Button Handler
    function handleInstall() {
      if (expressPartnerDeferredPrompt) {
        expressPartnerDeferredPrompt.prompt();
        expressPartnerDeferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted Express Partner PWA install');
          } else {
            console.log('User dismissed Express Partner PWA install');
          }
          expressPartnerDeferredPrompt = null;
        }).catch((error) => {
          console.error('Error during Express Partner PWA install:', error);
        });
      } else {
        // Fallback: show mobile instructions for mobile devices
        const platform = detectMobilePlatform();
        if (platform === 'ios' || platform === 'android') {
          showMobileInstallInstructions();
        } else {
          // Show generic hint for desktop
          const heroHint = document.getElementById('expressPartnerInstallHint');
          if (heroHint) {
            heroHint.classList.remove('hidden');
          }
        }
      }
    }

    document.addEventListener('DOMContentLoaded', function() {
      const installBtn = document.getElementById('expressPartnerInstallLandingBtn');
      const installHeroBtn = document.getElementById('expressPartnerInstallHeroBtn');
      const installHint = document.getElementById('expressPartnerInstallHint');
      
      if (installBtn) {
        installBtn.addEventListener('click', async function(e) {
          e.preventDefault();
          handleInstall();
          if (installHint) installHint.classList.remove('hidden');
        });
      }
      
      if (installHeroBtn) {
        installHeroBtn.addEventListener('click', async function(e) {
          e.preventDefault();
          handleInstall();
          if (installHint) installHint.classList.remove('hidden');
        });
      }
    });
  </script>
{% endblock %}
