<!DOCTYPE html>
<html lang="fa" dir="rtl" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>VINOR | بازار همه‌جانبه خرید و فروش</title>
  <meta name="description" content="وینور - بازار جامع خرید و فروش: املاک، خودرو، کالای دیجیتال، خدمات، استخدام و بیشتر. اپلیکیشن PWA سریع و آفلاین." />
  <meta name="theme-color" content="#16a34a">

  <!-- Favicon / Manifest -->
  <link rel="icon" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
  <link rel="canonical" href="{{ request.url_root.rstrip('/') }}">

  <!-- Open Graph / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="VINOR | بازار همه‌جانبه خرید و فروش">
  <meta property="og:description" content="بازار جامع خرید و فروش: املاک، خودرو، کالای دیجیتال، خانه و آشپزخانه، خدمات، استخدام و بیشتر. نصب آسان، سرعت بالا و کار آفلاین.">
  <meta property="og:image" content="{{ url_for('static', filename='og-cover.jpg', _external=true) }}">
  <meta property="og:url" content="{{ request.url }}">
  <meta name="twitter:card" content="summary_large_image">

  <!-- PWA / iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Tailwind & Icons -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome: local-first with CDN fallback -->
  <link rel="preload" as="font" href="{{ url_for('static', filename='vendor/fontawesome/webfonts/fa-solid-900.woff2') }}" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="{{ url_for('static', filename='vendor/fontawesome/webfonts/fa-regular-400.woff2') }}" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="{{ url_for('static', filename='vendor/fontawesome/webfonts/fa-brands-400.woff2') }}" type="font/woff2" crossorigin>
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome/css/all.min.css') }}" onerror="this.parentNode.removeChild(this)">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;600;800;900&display=swap" rel="stylesheet" />

  <style>
    :root{--brand:#16a34a;--brand-700:#15803d}
    html,body{font-family:'Vazirmatn',system-ui,Segoe UI,Roboto,sans-serif}
    .glass{backdrop-filter:saturate(140%) blur(8px);background:rgba(255,255,255,.7)}
    .dark .glass{background:rgba(17,24,39,.6)}
    .ring-brand{box-shadow:0 0 0 6px rgba(22,163,74,.12)}
    .focusable:focus{outline:2px solid var(--brand);outline-offset:2px}
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-950 text-gray-800 dark:text-gray-100">

  <!-- Header - Minimal -->
  <header class="sticky top-0 z-40 border-b border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-3 flex items-center justify-between">
      <a href="{{ url_for('main.index') }}" class="flex items-center gap-2 focusable" title="VINOR">
        <span class="bg-emerald-600 text-white w-9 h-9 flex items-center justify-center rounded-lg text-sm">
          <i class="fa-solid fa-seedling"></i>
        </span>
        <span dir="ltr" class="font-black text-lg">VINOR</span>
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm">
        <a href="#categories" class="text-gray-600 dark:text-gray-400 hover:text-emerald-600 focusable">دسته‌بندی‌ها</a>
        <a href="#about" class="text-gray-600 dark:text-gray-400 hover:text-emerald-600 focusable">درباره</a>
        <a href="#faq" class="text-gray-600 dark:text-gray-400 hover:text-emerald-600 focusable">سوالات</a>
      </nav>
      <div class="flex items-center gap-3">
        <a href="{{ url_for('main.start') }}" class="px-4 py-2 rounded-lg bg-emerald-600 text-white hover:bg-emerald-700 text-sm font-medium focusable">شروع</a>
        <button id="darkToggle" class="text-gray-600 dark:text-gray-400 hover:text-emerald-600 focusable" aria-label="تغییر تم">
          <i class="fa-solid fa-moon"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- HERO - Minimal Design -->
  <section id="app" class="relative overflow-hidden">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 py-16 sm:py-20 lg:py-28">
      <div class="text-center space-y-8">
        <!-- Logo & Brand -->
        <div class="space-y-4">
          <div class="flex items-center justify-center gap-3 mb-6">
            <div class="w-14 h-14 bg-emerald-600 rounded-xl flex items-center justify-center text-white text-2xl shadow-sm">
              <i class="fa-solid fa-seedling"></i>
            </div>
            <span dir="ltr" class="font-black text-3xl sm:text-4xl text-gray-900 dark:text-white">VINOR</span>
          </div>
          
          <h1 class="text-4xl sm:text-5xl lg:text-6xl font-black leading-tight text-gray-900 dark:text-white">
            بازار همه‌جانبه<br/>
            <span class="text-emerald-600">خرید و فروش</span>
          </h1>
        </div>

        <!-- Description - Minimal -->
        <div class="max-w-2xl mx-auto space-y-3">
          <p class="text-lg sm:text-xl text-gray-600 dark:text-gray-300 leading-relaxed font-medium">
            همه نیازهای خرید و فروش شما در یک پلتفرم
          </p>
          <p class="text-sm sm:text-base text-gray-500 dark:text-gray-400">
            ۱۰ دسته‌بندی جامع • صدها زیردسته • جستجوی هوشمند
          </p>
        </div>

        <!-- CTA Buttons - Minimal -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-3 pt-4">
          <button id="pwaInstallMain" class="w-full sm:w-auto px-8 py-3.5 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl transition-colors focusable">
            نصب اپلیکیشن
          </button>
          <a href="{{ url_for('main.app_home') }}" class="w-full sm:w-auto px-8 py-3.5 border border-gray-300 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-xl transition-colors focusable">
            شروع استفاده
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- دسته‌بندی‌ها - Minimal -->
  <section id="categories" class="py-16 sm:py-20 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="text-center mb-12 space-y-2">
        <h2 class="text-2xl sm:text-3xl font-black text-gray-900 dark:text-white">
          دسته‌بندی‌ها
        </h2>
        <p class="text-gray-500 dark:text-gray-400 text-sm sm:text-base">
          ۱۰ دسته‌بندی اصلی با صدها زیردسته
        </p>
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-5 gap-4">
        <!-- املاک -->
        <a href="{{ url_for('main.search_page', category='real_estate') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-emerald-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-emerald-100 dark:group-hover:bg-emerald-900/30 transition-colors">
            <i class="fa-solid fa-home text-xl text-emerald-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">املاک</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">آپارتمان، ویلا، زمین</p>
        </a>

        <!-- وسایل نقلیه -->
        <a href="{{ url_for('main.search_page', category='vehicles') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-blue-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-blue-100 dark:group-hover:bg-blue-900/30 transition-colors">
            <i class="fa-solid fa-car text-xl text-blue-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">وسایل نقلیه</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">خودرو، موتورسیکلت</p>
        </a>

        <!-- کالای دیجیتال -->
        <a href="{{ url_for('main.search_page', category='digital') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-purple-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-purple-50 dark:bg-purple-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-purple-100 dark:group-hover:bg-purple-900/30 transition-colors">
            <i class="fa-solid fa-laptop text-xl text-purple-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">کالای دیجیتال</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">موبایل، لپ‌تاپ</p>
        </a>

        <!-- خانه و آشپزخانه -->
        <a href="{{ url_for('main.search_page', category='home_kitchen') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-orange-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-orange-50 dark:bg-orange-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-orange-100 dark:group-hover:bg-orange-900/30 transition-colors">
            <i class="fa-solid fa-couch text-xl text-orange-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">خانه و آشپزخانه</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">لوازم خانگی</p>
        </a>

        <!-- خدمات -->
        <a href="{{ url_for('main.search_page', category='services') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-indigo-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-indigo-100 dark:group-hover:bg-indigo-900/30 transition-colors">
            <i class="fa-solid fa-tools text-xl text-indigo-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">خدمات</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">تعمیرات، آموزش</p>
        </a>

        <!-- وسایل شخصی -->
        <a href="{{ url_for('main.search_page', category='personal') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-pink-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-pink-50 dark:bg-pink-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-pink-100 dark:group-hover:bg-pink-900/30 transition-colors">
            <i class="fa-solid fa-user text-xl text-pink-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">وسایل شخصی</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">پوشاک، زیورآلات</p>
        </a>

        <!-- سرگرمی -->
        <a href="{{ url_for('main.search_page', category='entertainment') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-yellow-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-yellow-100 dark:group-hover:bg-yellow-900/30 transition-colors">
            <i class="fa-solid fa-gamepad text-xl text-yellow-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">سرگرمی</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">بلیت، کتاب</p>
        </a>

        <!-- اجتماعی -->
        <a href="{{ url_for('main.search_page', category='social') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-teal-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-teal-50 dark:bg-teal-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-teal-100 dark:group-hover:bg-teal-900/30 transition-colors">
            <i class="fa-solid fa-users text-xl text-teal-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">اجتماعی</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">رویداد، گم‌شده</p>
        </a>

        <!-- تجهیزات صنعتی -->
        <a href="{{ url_for('main.search_page', category='industrial') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-gray-100 dark:bg-gray-800 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-gray-200 dark:group-hover:bg-gray-700 transition-colors">
            <i class="fa-solid fa-industry text-xl text-gray-700 dark:text-gray-200"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">تجهیزات صنعتی</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">ماشین‌آلات، ابزار</p>
        </a>

        <!-- استخدام -->
        <a href="{{ url_for('main.search_page', category='jobs') }}" class="group p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:border-green-500 hover:bg-gray-50 dark:hover:bg-gray-800 transition-all focusable text-center">
          <div class="w-12 h-12 bg-green-50 dark:bg-green-900/20 rounded-lg flex items-center justify-center mb-3 mx-auto group-hover:bg-green-100 dark:group-hover:bg-green-900/30 transition-colors">
            <i class="fa-solid fa-briefcase text-xl text-green-600"></i>
          </div>
          <h3 class="font-semibold text-base mb-1 text-gray-900 dark:text-white">استخدام</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">کاریابی</p>
        </a>
      </div>

      <div class="text-center mt-12">
        <a href="{{ url_for('main.search_page') }}" class="inline-flex items-center gap-2 px-6 py-3 text-emerald-600 hover:text-emerald-700 font-medium focusable border-b-2 border-emerald-600 hover:border-emerald-700 transition-colors">
          <span>مشاهده همه دسته‌بندی‌ها</span>
          <i class="fa-solid fa-arrow-left"></i>
        </a>
      </div>
    </div>
  </section>

  <!-- معرفی VINOR - Minimal -->
  <section id="about" class="py-16 sm:py-20 border-t border-gray-200 dark:border-gray-800">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 text-center space-y-8">
      <div class="space-y-4">
        <h2 class="text-2xl sm:text-3xl font-black text-gray-900 dark:text-white">
          درباره وینور
        </h2>
        <p class="text-gray-600 dark:text-gray-300 text-base sm:text-lg leading-relaxed max-w-2xl mx-auto">
          بازار همه‌جانبه خرید و فروش با ۱۰ دسته‌بندی اصلی و صدها زیردسته. از املاک و خودرو تا کالای دیجیتال و خدمات - همه در یک پلتفرم.
        </p>
      </div>
      
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-6 pt-8">
        <div class="space-y-2">
          <div class="w-10 h-10 bg-emerald-50 dark:bg-emerald-900/20 rounded-lg flex items-center justify-center mx-auto">
            <i class="fa-solid fa-bolt text-emerald-600 text-lg"></i>
          </div>
          <h3 class="font-semibold text-sm text-gray-900 dark:text-white">سرعت بالا</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">بارگذاری سریع</p>
        </div>
        
        <div class="space-y-2">
          <div class="w-10 h-10 bg-blue-50 dark:bg-blue-900/20 rounded-lg flex items-center justify-center mx-auto">
            <i class="fa-solid fa-wifi-slash text-blue-600 text-lg"></i>
          </div>
          <h3 class="font-semibold text-sm text-gray-900 dark:text-white">کار آفلاین</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">بدون اینترنت</p>
        </div>
        
        <div class="space-y-2">
          <div class="w-10 h-10 bg-purple-50 dark:bg-purple-900/20 rounded-lg flex items-center justify-center mx-auto">
            <i class="fa-solid fa-bell text-purple-600 text-lg"></i>
          </div>
          <h3 class="font-semibold text-sm text-gray-900 dark:text-white">اعلان‌های فوری</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">اطلاع‌رسانی لحظه‌ای</p>
        </div>
        
        <div class="space-y-2">
          <div class="w-10 h-10 bg-green-50 dark:bg-green-900/20 rounded-lg flex items-center justify-center mx-auto">
            <i class="fa-solid fa-shield-halved text-green-600 text-lg"></i>
          </div>
          <h3 class="font-semibold text-sm text-gray-900 dark:text-white">امن و مطمئن</h3>
          <p class="text-xs text-gray-500 dark:text-gray-400">آگهی‌های تأییدشده</p>
        </div>
      </div>
    </div>
  </section>

  <!-- نصب PWA - Minimal -->
  <section id="features" class="py-16 sm:py-20 bg-gray-50 dark:bg-gray-950 border-t border-gray-200 dark:border-gray-800">
    <div class="max-w-3xl mx-auto px-4 sm:px-6 text-center space-y-8">
      <div class="space-y-3">
        <h2 class="text-2xl sm:text-3xl font-black text-gray-900 dark:text-white">
          نصب اپلیکیشن
        </h2>
        <p class="text-gray-500 dark:text-gray-400 text-sm sm:text-base">
          نصب سریع و رایگان بدون نیاز به استور
        </p>
      </div>
      
      <button id="quickInstall" class="w-full sm:w-auto px-8 py-3.5 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold rounded-xl transition-colors focusable">
        نصب VINOR
      </button>
    </div>
  </section>



  <!-- FAQ - Minimal -->
  <section id="faq" class="py-16 sm:py-20 border-t border-gray-200 dark:border-gray-800">
    <div class="max-w-3xl mx-auto px-4 sm:px-6">
      <h2 class="text-2xl sm:text-3xl font-black text-center mb-10 text-gray-900 dark:text-white">
        سوالات متداول
      </h2>
      <div class="space-y-3">
        <details class="group border-b border-gray-200 dark:border-gray-700 py-4">
          <summary class="cursor-pointer font-semibold flex items-center justify-between text-gray-900 dark:text-white">
            <span>PWA چیست؟</span>
            <i class="fa-solid fa-plus text-gray-400 text-sm group-open:rotate-45 transition-transform"></i>
          </summary>
          <p class="mt-3 text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
            اپلیکیشن پیشرفته وب که از طریق مرورگر نصب می‌شود و تجربه‌ای مشابه اپلیکیشن‌های بومی ارائه می‌دهد.
          </p>
        </details>
        
        <details class="group border-b border-gray-200 dark:border-gray-700 py-4">
          <summary class="cursor-pointer font-semibold flex items-center justify-between text-gray-900 dark:text-white">
            <span>آیا روی iOS کار می‌کند؟</span>
            <i class="fa-solid fa-plus text-gray-400 text-sm group-open:rotate-45 transition-transform"></i>
          </summary>
          <p class="mt-3 text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
            بله، از Safari وارد شوید و Add to Home Screen را انتخاب کنید.
          </p>
        </details>
        
        <details class="group border-b border-gray-200 dark:border-gray-700 py-4">
          <summary class="cursor-pointer font-semibold flex items-center justify-between text-gray-900 dark:text-white">
            <span>چقدر فضا اشغال می‌کند؟</span>
            <i class="fa-solid fa-plus text-gray-400 text-sm group-open:rotate-45 transition-transform"></i>
          </summary>
          <p class="mt-3 text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
            کمتر از ۱۰ مگابایت برای کش و داده‌های ضروری.
          </p>
        </details>
        
        <details class="group border-b border-gray-200 dark:border-gray-700 py-4">
          <summary class="cursor-pointer font-semibold flex items-center justify-between text-gray-900 dark:text-white">
            <span>آیا بدون اینترنت کار می‌کند؟</span>
            <i class="fa-solid fa-plus text-gray-400 text-sm group-open:rotate-45 transition-transform"></i>
          </summary>
          <p class="mt-3 text-gray-600 dark:text-gray-400 text-sm leading-relaxed">
            بله، می‌توانید آگهی‌های مشاهده شده را بدون اینترنت ببینید.
          </p>
        </details>
      </div>
    </div>
  </section>

  <!-- نوار چسبان موبایل - Minimal -->
  <div class="sm:hidden fixed bottom-0 inset-x-0 z-40 border-t border-gray-200 dark:border-gray-800 bg-white dark:bg-gray-900 p-4">
    <button id="pwaInstallMobileMain" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-3 rounded-xl transition-colors focusable">
      نصب اپلیکیشن
    </button>
  </div>

  <script>
    // --- Dark Mode ---
    const root = document.documentElement;
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'light') root.classList.remove('dark');
    document.getElementById('darkToggle')?.addEventListener('click', () => {
      root.classList.toggle('dark');
      localStorage.setItem('theme', root.classList.contains('dark') ? 'dark' : 'light');
    });

    // --- PWA Install Hooks ---
    let deferredPrompt;
    let installAttempts = 0;

    // Handle PWA install prompt
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;

      // Show install buttons when PWA is available
      const installButtons = document.querySelectorAll('#pwaInstallMain, #pwaInstallMobileMain, #quickInstall');
      installButtons.forEach(btn => {
        btn.style.display = 'block';
      });
    });

    // Handle successful installation
    window.addEventListener('appinstalled', (evt) => {
      console.log('PWA was installed successfully');
      deferredPrompt = null;

      // Hide install buttons after successful install
      const installButtons = document.querySelectorAll('#pwaInstallMain, #pwaInstallMobileMain, #quickInstall');
      installButtons.forEach(btn => {
        btn.textContent = 'نصب شد';
        btn.disabled = true;
        btn.classList.add('opacity-50');
      });
    });

    // PWA Install Button Handlers
    const installButtonIds = ['pwaInstallMain', 'pwaInstallMobileMain', 'quickInstall'];
    installButtonIds.forEach(id => {
      const btn = document.getElementById(id);
      if (btn) {
        btn.addEventListener('click', async (ev) => {
          ev.preventDefault();
          installAttempts++;

          if (deferredPrompt) {
            try {
              deferredPrompt.prompt();
              const { outcome } = await deferredPrompt.userChoice;

              if (outcome === 'accepted') {
                console.log('User accepted the PWA install prompt');
              } else {
                console.log('User dismissed the PWA install prompt');
              }

              deferredPrompt = null;
            } catch (error) {
              console.error('Error during PWA install:', error);
            }
          } else {
            // Fallback for browsers that don't support beforeinstallprompt
            alert('برای نصب PWA، از مرورگر کروم، اج یا فایرفاکس استفاده کنید.');
          }
        });
      }
    });


    // --- Analytics for install attempts ---
    window.addEventListener('load', () => {
      // Track page views for install conversion
      if (navigator.serviceWorker) {
        navigator.serviceWorker.ready.then(() => {
          console.log('PWA ready for install');
        });
      }
    });

    // --- Register Service Worker + Warmup app shell for guests too ---
    (function(){
      if (!('serviceWorker' in navigator)) return;
      // Use the same SW route as the main app
      navigator.serviceWorker.register('/sw.js', { scope: '/' }).then(async (reg)=>{
        try{
          await navigator.serviceWorker.ready;
          const sw = navigator.serviceWorker.controller;
          if (sw){
            const urls = [
              '/', '/app', '/search', '/api/lands/approved'
            ];
            sw.postMessage({ type: 'VINOR_WARMUP', urls });
          }
        }catch(_){ }
      }).catch(()=>{});
    })();
  </script>
</body>
</html>
