{% extends "base.html" %}
{% block title %}جستجوی زمین{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8 p-4 bg-white dark:bg-gray-800 rounded-xl shadow">

  <!-- 🔍 جستجو سریع -->
  <form method="get" action="{{ url_for('main.search_results') }}" class="space-y-4" id="search-form">
    <input type="text" name="q" placeholder="مثلاً دشت اول، دوبر، قولنامه..."
           class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"
           value="{{ request.args.get('q', '') }}" oninput="storeSearchQuery(this.value)">

    <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition">
      🔍 جستجو کن
    </button>

    <!-- 📁 فیلترهای بیشتر -->
    <details class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mt-4">
      <summary class="cursor-pointer text-sm font-medium text-gray-800 dark:text-white">
        فیلترهای پیشرفته ⬇️
      </summary>
      <div class="mt-4 space-y-3 text-sm text-gray-800 dark:text-white">
        <div class="flex gap-2">
          <input type="number" name="min_price" placeholder="حداقل قیمت"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('min_price', '') }}">
          <input type="number" name="max_price" placeholder="حداکثر قیمت"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('max_price', '') }}">
        </div>

        <div class="flex gap-2">
          <input type="number" name="min_size" placeholder="حداقل متراژ"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('min_size', '') }}">
          <input type="number" name="max_size" placeholder="حداکثر متراژ"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('max_size', '') }}">
        </div>
      </div>
    </details>
  </form>
</div>

<!-- 🕓 جستجوهای اخیر -->
<div class="max-w-2xl mx-auto mt-6 p-4 bg-gray-50 dark:bg-gray-900 rounded-xl shadow text-sm">
  <h2 class="font-semibold text-gray-700 dark:text-white mb-2">🕓 جستجوهای اخیر</h2>
  <ul id="search-history" class="text-gray-600 dark:text-gray-300 space-y-1"></ul>
</div>

<script>
// ذخیره عبارت جستجو در localStorage
function storeSearchQuery(q) {
  if (!q.trim()) return;
  let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
  if (!history.includes(q)) {
    history.unshift(q);
    if (history.length > 5) history = history.slice(0, 5);
    localStorage.setItem('searchHistory', JSON.stringify(history));
    renderSearchHistory();
  }
}

// نمایش تاریخچه
function renderSearchHistory() {
  const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
  const ul = document.getElementById('search-history');
  ul.innerHTML = '';
  history.forEach(item => {
    ul.innerHTML += `<li class="border-b pb-1 cursor-pointer hover:text-blue-600"
                      onclick="document.querySelector('input[name=q]').value='${item}'">
                      🔹 ${item}</li>`;
  });
}
renderSearchHistory();
</script>
{% endblock %}
