{% extends "base.html" %}
{% block title %}Ø¬Ø³ØªØ¬ÙˆÛŒ Ø²Ù…ÛŒÙ†{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto mt-8 p-4 bg-white dark:bg-gray-800 rounded-xl shadow">

  <!-- ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ø³Ø±ÛŒØ¹ -->
  <form method="get" action="{{ url_for('main.search_results') }}" class="space-y-4" id="search-form">
    <input type="text" name="q" placeholder="Ù…Ø«Ù„Ø§Ù‹ Ø¯Ø´Øª Ø§ÙˆÙ„ØŒ Ø¯ÙˆØ¨Ø±ØŒ Ù‚ÙˆÙ„Ù†Ø§Ù…Ù‡..."
           class="w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white text-sm"
           value="{{ request.args.get('q', '') }}" oninput="storeSearchQuery(this.value)">

    <button type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition">
      ğŸ” Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†
    </button>

    <!-- ğŸ“ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ± -->
    <details class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mt-4">
      <summary class="cursor-pointer text-sm font-medium text-gray-800 dark:text-white">
        ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ â¬‡ï¸
      </summary>
      <div class="mt-4 space-y-3 text-sm text-gray-800 dark:text-white">
        <div class="flex gap-2">
          <input type="number" name="min_price" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Ù‚ÛŒÙ…Øª"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('min_price', '') }}">
          <input type="number" name="max_price" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø± Ù‚ÛŒÙ…Øª"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('max_price', '') }}">
        </div>

        <div class="flex gap-2">
          <input type="number" name="min_size" placeholder="Ø­Ø¯Ø§Ù‚Ù„ Ù…ØªØ±Ø§Ú˜"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('min_size', '') }}">
          <input type="number" name="max_size" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø± Ù…ØªØ±Ø§Ú˜"
                 class="w-1/2 px-3 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-600 dark:text-white"
                 value="{{ request.args.get('max_size', '') }}">
        </div>
      </div>
    </details>
  </form>
</div>

<!-- ğŸ•“ Ø¬Ø³ØªØ¬ÙˆÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ± -->
<div class="max-w-2xl mx-auto mt-6 p-4 bg-gray-50 dark:bg-gray-900 rounded-xl shadow text-sm">
  <h2 class="font-semibold text-gray-700 dark:text-white mb-2">ğŸ•“ Ø¬Ø³ØªØ¬ÙˆÙ‡Ø§ÛŒ Ø§Ø®ÛŒØ±</h2>
  <ul id="search-history" class="text-gray-600 dark:text-gray-300 space-y-1"></ul>
</div>

<script>
// Ø°Ø®ÛŒØ±Ù‡ Ø¹Ø¨Ø§Ø±Øª Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± localStorage
function storeSearchQuery(q) {
  if (!q.trim()) return;
  let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
  if (!history.includes(q)) {
    history.unshift(q);
    if (history.length > 5) history = history.slice(0, 5);
    localStorage.setItem('searchHistory', JSON.stringify(history));
    renderSearchHistory();
  }
}

// Ù†Ù…Ø§ÛŒØ´ ØªØ§Ø±ÛŒØ®Ú†Ù‡
function renderSearchHistory() {
  const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
  const ul = document.getElementById('search-history');
  ul.innerHTML = '';
  history.forEach(item => {
    ul.innerHTML += `<li class="border-b pb-1 cursor-pointer hover:text-blue-600"
                      onclick="document.querySelector('input[name=q]').value='${item}'">
                      ğŸ”¹ ${item}</li>`;
  });
}
renderSearchHistory();
</script>
{% endblock %}
