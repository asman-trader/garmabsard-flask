{% extends 'base.html' %}

{% block title %}ุชูุธูุงุช ุญุณุงุจ | ฺฏุฑูุงุจุณุฑุฏ{% endblock %}

{% block content %}
<div class="max-w-xl mx-auto bg-white dark:bg-gray-800 p-5 sm:p-6 rounded-xl shadow mt-6 sm:mt-10">

  <h2 class="text-xl sm:text-2xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2">
    โ๏ธ ุชูุธูุงุช ุญุณุงุจ ฺฉุงุฑุจุฑ
  </h2>

  {% if user %}
  <form method="post" action="{{ url_for('main.settings') }}" class="space-y-6">

    <!-- ุดูุงุฑู ููุจุงู -->
    <div>
      <label class="block text-sm mb-1 text-gray-600 dark:text-gray-300">ุดูุงุฑู ููุจุงู (ุบุฑูุงุจู ุชุบุฑ)</label>
      <input type="text" value="{{ user.phone }}" disabled
             class="w-full border rounded px-3 py-2 bg-gray-100 text-gray-500 dark:bg-slate-700 dark:text-gray-400 dark:border-slate-600" />
    </div>

    <!-- ูุงู -->
    <div>
      <label class="block text-sm mb-1 text-gray-600 dark:text-gray-300">ูุงู</label>
      <input type="text" name="first_name" value="{{ user.first_name or '' }}" required
             class="w-full border rounded px-3 py-2 dark:bg-slate-700 dark:border-slate-600 dark:text-white" />
    </div>

    <!-- ูุงู ุฎุงููุงุฏฺฏ -->
    <div>
      <label class="block text-sm mb-1 text-gray-600 dark:text-gray-300">ูุงู ุฎุงููุงุฏฺฏ</label>
      <input type="text" name="last_name" value="{{ user.last_name or '' }}"
             class="w-full border rounded px-3 py-2 dark:bg-slate-700 dark:border-slate-600 dark:text-white" />
    </div>

    <!-- ุงุณุชุงู -->
    <div>
      <label class="block text-sm mb-1 text-gray-600 dark:text-gray-300">ุงุณุชุงู</label>
      <select name="province" id="province-select" onchange="loadCities()" required
              class="w-full border rounded px-3 py-2 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
        <option value="">ุงูุชุฎุงุจ ฺฉูุฏ...</option>
        <option value="ุชูุฑุงู" {{ 'selected' if user.province == 'ุชูุฑุงู' else '' }}>ุชูุฑุงู</option>
        <option value="ุงูุจุฑุฒ" {{ 'selected' if user.province == 'ุงูุจุฑุฒ' else '' }}>ุงูุจุฑุฒ</option>
        <option value="ูุงุฒูุฏุฑุงู" {{ 'selected' if user.province == 'ูุงุฒูุฏุฑุงู' else '' }}>ูุงุฒูุฏุฑุงู</option>
        <!-- ุงุณุชุงูโูุง ุฏฺฏุฑ -->
      </select>
    </div>

    <!-- ุดูุฑ -->
    <div>
      <label class="block text-sm mb-1 text-gray-600 dark:text-gray-300">ุดูุฑ</label>
      <select name="city" id="city-select" required
              class="w-full border rounded px-3 py-2 dark:bg-slate-700 dark:border-slate-600 dark:text-white">
        {% if user.city %}
          <option value="{{ user.city }}" selected>{{ user.city }}</option>
        {% else %}
          <option value="">ุงุจุชุฏุง ุงุณุชุงู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</option>
        {% endif %}
      </select>
    </div>

    <!-- ุชุบุฑ ุฑูุฒ ุนุจูุฑ -->
    <div class="border-t pt-4 dark:border-slate-600">
      <label class="block text-sm mb-2 text-gray-600 dark:text-gray-300">ุชุบุฑ ุฑูุฒ ุนุจูุฑ (ุงุฎุชุงุฑ)</label>
      <input type="password" name="new_password" placeholder="ุฑูุฒ ุฌุฏุฏ"
             class="w-full border rounded px-3 py-2 dark:bg-slate-700 dark:border-slate-600 dark:text-white" />
    </div>

    <!-- ุฐุฎุฑู -->
    <div class="pt-2">
      <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded shadow text-sm w-full">
        ๐พ ุฐุฎุฑู ุชุบุฑุงุช
      </button>
    </div>

  </form>
  {% else %}
  <div class="text-red-600 mt-6">ุฎุทุง: ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ ุงูุช ูุดุฏ.</div>
  {% endif %}

</div>

<!-- JS ุจุงุฑฺฏุฐุงุฑ ุดูุฑูุง -->
<script>
  const cities = {
    'ุชูุฑุงู': ['ุชูุฑุงู', 'ุฏูุงููุฏ', 'ูุฑุงูู', 'ุงุณูุงูโุดูุฑ'],
    'ุงูุจุฑุฒ': ['ฺฉุฑุฌ', 'ูุธุฑุขุจุงุฏ', 'ุทุงููุงู'],
    'ูุงุฒูุฏุฑุงู': ['ุณุงุฑ', 'ุขูู', 'ุจุงุจู', 'ฺุงููุณ']
  };

  function loadCities() {
    const province = document.getElementById('province-select').value;
    const citySelect = document.getElementById('city-select');
    citySelect.innerHTML = '';
    if (province in cities) {
      cities[province].forEach(city => {
        const option = document.createElement('option');
        option.value = city;
        option.textContent = city;
        citySelect.appendChild(option);
      });
    } else {
      const option = document.createElement('option');
      option.value = '';
      option.textContent = 'ุงุจุชุฏุง ุงุณุชุงู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ';
      citySelect.appendChild(option);
    }
  }

  // ุจุงุฑฺฏุฐุงุฑ ุฎูุฏฺฉุงุฑ ุงฺฏุฑ ุงุณุชุงู ุงูุชุฎุงุจ ุดุฏู
  window.addEventListener('DOMContentLoaded', () => {
    const selectedProvince = document.getElementById('province-select').value;
    if (selectedProvince) loadCities();
  });
</script>
{% endblock %}
