{# side_menu.html - compact & clean architecture with user header #}
{% macro MenuItem(href, icon, text, require_login=False, badge=None) -%}
  <a href="{{ href }}"
     class="group flex items-center gap-3 p-2 rounded-lg transition
            hover:bg-green-100 dark:hover:bg-green-800
            focus:outline-none focus:ring-2 focus:ring-green-500
            {{ 'require-login' if require_login else '' }}">
    <i class="fas {{ icon }} text-green-600 dark:text-green-400"></i>
    <span class="text-sm font-medium text-gray-800 dark:text-gray-100">{{ text }}</span>
    {% if badge and badge|int > 0 %}
      <span class="ml-auto inline-flex items-center justify-center min-w-5 h-5 px-2 text-[11px] rounded-full
                   bg-red-500 text-white">{{ badge }}</span>
    {% endif %}
  </a>
{%- endmacro %}

<aside id="sideMenu"
       class="fixed top-0 right-0 z-50 w-72 h-full
              translate-x-full sm:translate-x-0
              bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-700
              shadow-xl transition-transform duration-300 ease-in-out">

{# Header: clickable user info + quick menu #}
<header class="sticky top-0 bg-white/80 dark:bg-gray-900/80 backdrop-blur
               border-b border-gray-200 dark:border-gray-700 px-4 py-4">
  <div class="flex items-center justify-between">

    {# User clickable link #}
    <a href="{{ url_for('main.profile') if session.get('user_phone') else url_for('main.send_otp') }}"
       class="flex items-center gap-2 text-base font-bold text-gray-800 dark:text-white
              hover:text-green-700 dark:hover:text-green-300 transition"
       title="{{ 'رفتن به پروفایل' if session.get('user_phone') else 'ورود / ثبت‌نام' }}">
      <i class="fas fa-user-circle text-green-600 dark:text-green-400 text-xl"></i>
      {% if session.get('user_phone') %}
        {{ session['user_phone'] }}
      {% else %}
        مهمان
      {% endif %}
    </a>

    <div class="flex items-center gap-2">
      {# Quick menu (3 dots) #}
      <div class="relative group">
        <button class="p-2 text-gray-600 dark:text-gray-300 hover:text-green-600"
                aria-label="منوی سریع">
          <i class="fas fa-ellipsis-v"></i>
        </button>
        <div class="absolute left-0 mt-2 w-36 hidden group-hover:block
                    bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700
                    rounded-lg shadow-lg overflow-hidden z-50">
          <a href="{{ url_for('main.settings') }}"
             class="flex items-center gap-2 px-3 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">
            <i class="fas fa-cog"></i> تنظیمات
          </a>
          {% if session.get('user_phone') %}
            <a href="{{ url_for('main.logout') }}"
               class="flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-700">
              <i class="fas fa-sign-out-alt"></i> خروج
            </a>
          {% else %}
            <a href="{{ url_for('main.send_otp') }}"
               class="flex items-center gap-2 px-3 py-2 text-sm text-green-600 hover:bg-green-50 dark:hover:bg-green-700">
              <i class="fas fa-sign-in-alt"></i> ورود / ثبت‌نام
            </a>
          {% endif %}
        </div>
      </div>

      {# Close button #}
      <button id="closeMenu"
              class="sm:hidden text-xl text-gray-600 dark:text-gray-300 hover:text-red-500"
              aria-label="بستن منو">
        <i class="fas fa-times-circle"></i>
      </button>
    </div>
  </div>
</header>



  {# Body #}
  <div class="p-4 space-y-3">

    {{ MenuItem(url_for('main.submit_ad'), 'fa-plus-circle', 'ثبت آگهی رایگان', True) }}
    {{ MenuItem(url_for('main.index'), 'fa-home', 'خانه') }}
    {{ MenuItem(url_for('main.notifications'), 'fa-bell', 'اعلان‌ها', True, notif_count or 0) }}

    <hr class="my-2 border-gray-300 dark:border-gray-700" />

    {{ MenuItem(url_for('main.profile'), 'fa-user', 'ناحیه کاربری', True) }}
    {{ MenuItem(url_for('main.my_lands'), 'fa-list', 'آگهی‌های من', True) }}
    {{ MenuItem(url_for('main.favorites'), 'fa-heart', 'علاقه‌مندی‌ها', True) }}
    {{ MenuItem(url_for('main.settings'), 'fa-cog', 'تنظیمات', True) }}

    {% if session.get('user_phone') %}
      <a href="{{ url_for('main.logout') }}"
         class="flex items-center gap-3 p-2 rounded-lg transition
                text-red-600 hover:bg-red-100 dark:hover:bg-red-800">
        <i class="fas fa-sign-out-alt"></i>
        <span class="text-sm font-medium">خروج</span>
      </a>
    {% else %}
      <a href="{{ url_for('main.send_otp') }}"
         class="flex items-center gap-3 p-2 rounded-lg transition
                text-green-700 hover:bg-green-100 dark:hover:bg-green-800">
        <i class="fas fa-sign-in-alt"></i>
        <span class="text-sm font-medium">ورود / ثبت‌نام</span>
      </a>
    {% endif %}

  </div>
</aside>
