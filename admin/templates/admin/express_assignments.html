{% extends 'admin/base_admin.html' %}
{% block title %}انتساب فایل‌ها به همکاران | پنل مدیریت{% endblock %}
{% block page_title %}
<h1 class="text-xl sm:text-2xl font-extrabold tracking-tight text-vinor-700 dark:text-green-400 flex items-center gap-2">
  <i class="fas fa-share-nodes"></i>
  انتساب فایل‌ها به همکاران
{% endblock %}
{% block content %}
<div class="grid lg:grid-cols-2 gap-4">
  <div class="bg-white dark:bg-gray-800 rounded-xl border dark:border-gray-700 p-4">
    <h2 class="font-semibold mb-3">ایجاد انتساب جدید</h2>
    <form method="post" action="{{ url_for('admin.express_assignment_new') }}" class="grid sm:grid-cols-3 gap-2">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <select name="partner_phone" class="border rounded-md px-2 py-2" required>
        <option value="">انتخاب همکار…</option>
        {% for p in partners %}
          <option value="{{ p.phone }}">{{ p.name or p.phone }} ({{ p.phone }})</option>
        {% endfor %}
      </select>
      <select name="land_code" class="border rounded-md px-2 py-2" required>
        <option value="">انتخاب فایل…</option>
        {% for l in lands %}
          <option value="{{ l.code }}">{{ l.code }} — {{ l.title }}</option>
        {% endfor %}
      </select>
      <input type="number" step="0.1" min="0" max="100" name="commission_pct" class="border rounded-md px-2 py-2" placeholder="٪ پورسانت (مثلاً 5)">
      <div class="sm:col-span-3">
        <button class="px-3 py-2 rounded-md bg-emerald-600 text-white">ثبت انتساب</button>
      </div>
    </form>
  </div>

  <div class="bg-white dark:bg-gray-800 rounded-xl border dark:border-gray-700 p-4">
    <h2 class="font-semibold mb-3">انتساب‌های فعال/بسته</h2>
    <div class="overflow-x-auto">
      <table class="w-full text-sm">
        <thead>
          <tr class="text-right text-gray-600 dark:text-gray-300">
            <th class="p-2">#</th>
            <th class="p-2">همکار</th>
            <th class="p-2">کد فایل</th>
            <th class="p-2">پورسانت</th>
            <th class="p-2">وضعیت</th>
            <th class="p-2">اقدامات</th>
          </tr>
        </thead>
        <tbody>
          {% for a in items %}
            <tr class="border-t dark:border-gray-700">
              <td class="p-2">{{ a.id }}</td>
              <td class="p-2">{{ a.partner_phone }}</td>
              <td class="p-2">{{ a.land_code }}</td>
              <td class="p-2">{{ a.commission_pct or 0 }}%</td>
              <td class="p-2">{{ a.status }}</td>
              <td class="p-2">
                {% if a.status != 'closed' %}
                <form method="post" action="{{ url_for('admin.express_assignment_close', aid=a.id) }}" class="inline">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button class="px-2 py-1 rounded bg-rose-600 text-white text-xs">بستن</button>
                </form>
                {% endif %}
              </td>
            </tr>
          {% else %}
            <tr><td class="p-2 text-gray-500" colspan="6">موردی ثبت نشده است.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}


