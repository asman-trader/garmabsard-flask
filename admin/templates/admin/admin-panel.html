<!DOCTYPE html>
<html lang="fa" dir="rtl" x-data="{ darkMode: false, sidebarOpen: true }" :class="{ 'dark': darkMode }"
      x-init="darkMode = localStorage.getItem('darkMode') === 'true'">
<head>
  <meta charset="UTF-8" />
  <title>پنل مدیریت | وینور (Vinor)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['iranyekan', 'ui-sans-serif', 'system-ui'] },
          colors: { vinor: { 600: '#0ea5e9', 700: '#0284c7' } }
        }
      }
    }
  </script>
  <link rel="preload" as="font" type="font/woff2" crossorigin
        href="{{ url_for('static', filename='fonts/iranyekan.woff2') }}">
  <link rel="preload" as="font" href="{{ url_for('static', filename='vendor/fontawesome/webfonts/fa-solid-900.woff2') }}" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="{{ url_for('static', filename='vendor/fontawesome/webfonts/fa-regular-400.woff2') }}" type="font/woff2" crossorigin>
  <link rel="preload" as="font" href="{{ url_for('static', filename='vendor/fontawesome/webfonts/fa-brands-400.woff2') }}" type="font/woff2" crossorigin>
  <link rel="stylesheet" href="{{ url_for('static', filename='vendor/fontawesome/css/all.min.css') }}">
  <style>
    @font-face {
      font-family: 'iranyekan';
      src: url('{{ url_for('static', filename='fonts/iranyekan.woff2') }}') format('woff2');
      font-weight: 100 900; font-style: normal; font-display: swap;
    }
    body { font-family: 'iranyekan', ui-sans-serif, system-ui; }
  </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-100 min-h-screen flex">

  <!-- سایدبار -->
  <aside class="w-64 bg-white dark:bg-gray-800 border-l border-gray-200 dark:border-gray-700 h-screen p-4 fixed right-0 top-0 hidden lg:block">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-lg font-bold text-vinor-700 dark:text-vinor-600">پنل مدیریت وینور</h2>
      <button class="text-gray-500 hover:text-yellow-400" @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode)" aria-label="تغییر حالت تیره">
        <svg x-show="!darkMode" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
             viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75"
             d="M12 3v2m0 14v2m7-9h2M3 12H1m15.364-6.364l1.414 1.414M4.222 19.778l1.414-1.414m0-12.728L4.222 4.222M18.778 19.778l-1.414-1.414M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg>
        <svg x-show="darkMode" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24"
             fill="currentColor"><path d="M21.64 13.01A9 9 0 1111 2.36a7 7 0 0010.64 10.65z"/></svg>
      </button>
    </div>
    <nav class="flex flex-col gap-2 text-sm">
      <a href="{{ url_for('admin.pending_lands') }}" class="px-3 py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700">📋 آگهی‌های در انتظار</a>
      <a href="{{ url_for('admin.approved_lands') }}" class="px-3 py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700">✅ آگهی‌های تأیید شده</a>
      <a href="{{ url_for('admin.rejected_lands') }}" class="px-3 py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700">⛔ آگهی‌های رد شده</a>
      <a href="{{ url_for('admin.add_land') }}" class="px-3 py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700">➕ افزودن آگهی</a>
      <a href="{{ url_for('admin.settings') }}" class="px-3 py-2 rounded hover:bg-gray-50 dark:hover:bg-gray-700">⚙️ تنظیمات</a>
      <form method="post" action="{{ url_for('admin.logout') }}" class="mt-2">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="w-full text-left px-3 py-2 rounded text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20">🚪 خروج</button>
      </form>
    </nav>
  </aside>

  <!-- محتوای اصلی -->
  <main class="flex-1 w-full lg:mr-64 p-4 sm:p-6">
    <!-- هدر موبایل -->
    <div class="lg:hidden mb-4 flex items-center justify-between">
      <h1 class="text-lg font-bold text-vinor-700 dark:text-vinor-600">مدیریت آگهی‌ها</h1>
      <div class="flex items-center gap-3">
        <a href="{{ url_for('admin.add_land') }}" class="px-3 py-1.5 rounded bg-vinor-600 text-white text-sm">افزودن</a>
        <button class="text-gray-500 hover:text-yellow-400" @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode)" aria-label="تغییر حالت تیره">
          <svg x-show="!darkMode" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
               viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.75"
               d="M12 3v2m0 14v2m7-9h2M3 12H1m15.364-6.364l1.414 1.414M4.222 19.778l1.414-1.414m0-12.728L4.222 4.222M18.778 19.778l-1.414-1.414M12 8a4 4 0 100 8 4 4 0 000-8z"/></svg>
          <svg x-show="darkMode" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24"
               fill="currentColor"><path d="M21.64 13.01A9 9 0 1111 2.36a7 7 0 0010.64 10.65z"/></svg>
        </button>
      </div>
    </div>

    <!-- عنوان صفحه -->
    <h1 class="hidden lg:block text-2xl font-bold mb-6 text-vinor-700 dark:text-vinor-600">مدیریت آگهی‌ها</h1>

    <!-- لیست آگهی‌ها (کارت‌ها) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-10">
      {% for land in lands %}
      <div class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl shadow p-4 flex flex-col">
        {% set cover = (land.images[0] if land.images and land.images|length > 0 else None) %}
        {% if cover %}
          <img src="{{ cover if ('://' in cover) else (('/uploads/' + cover) if not cover.startswith('/uploads/') else cover) }}"
               class="w-full h-40 object-cover rounded-xl mb-3" alt="عکس آگهی">
        {% endif %}
        <h3 class="font-semibold text-base sm:text-lg text-gray-800 dark:text-gray-100">{{ land.title or 'بدون عنوان' }}</h3>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">{{ land.size }} متر • {{ land.location }}</p>
        <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">کد: {{ land.code }}</p>

        <div class="mt-4 flex items-center justify-between gap-2">
          <!-- حذف (POST + CSRF) -->
          <form method="post" action="{{ url_for('admin.delete_land', land_id=loop.index0) }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit"
                    class="px-3 py-1.5 rounded-lg text-white bg-rose-600 hover:bg-rose-700 text-sm">
              🗑 حذف
            </button>
          </form>

          <!-- ویرایش -->
          <a href="{{ url_for('admin.edit_land', land_id=loop.index0) }}"
             class="px-3 py-1.5 rounded-lg text-white bg-vinor-600 hover:bg-vinor-700 text-sm">
            ✏️ ویرایش
          </a>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- فرم افزودن آگهی (می‌توانید این بخش را حذف کنید و از صفحه جداگانه استفاده کنید) -->
    <section id="uploadForm" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 p-4 sm:p-6 rounded-2xl shadow">
      <h2 class="text-lg sm:text-xl font-bold mb-4 text-vinor-700 dark:text-vinor-600">افزودن آگهی جدید</h2>
      <form action="{{ url_for('admin.add_land') }}" method="post" enctype="multipart/form-data" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="text" name="title" placeholder="عنوان" class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600" required>
        <input type="text" name="size" placeholder="متراژ (مثلاً 500)" class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600" required>
        <input type="text" name="location" placeholder="موقعیت (مثلاً دشت اول)" class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600" required>

        <!-- کد آگهی در بک‌اند به‌صورت خودکار تولید می‌شود؛ این فیلد را حذف کردیم -->
        <div class="sm:col-span-2">
          <label class="block text-sm text-gray-600 dark:text-gray-300 mb-1">عکس‌ها (می‌توانید چند مورد انتخاب کنید)</label>
          <input type="file" name="images" multiple class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600">
        </div>

        <textarea name="description" placeholder="توضیحات"
                  class="sm:col-span-2 w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600" rows="3"></textarea>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:col-span-2">
          <input type="text" name="category" placeholder="دسته‌بندی (زمین/باغ/ویلا/آپارتمان)" class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600">
          <input type="text" name="document_type" placeholder="نوع سند (مثلاً تک‌برگ)" class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600">
          <input type="text" name="price_total" placeholder="قیمت کل (تومان)" class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600">
          <input type="text" name="price_per_meter" placeholder="قیمت هر متر (تومان)" class="w-full p-2 border rounded-lg bg-gray-50 dark:bg-gray-900 border-gray-300 dark:border-gray-600">
        </div>

        <div class="sm:col-span-2 flex justify-end">
          <button type="submit" class="px-4 py-2 rounded-lg bg-vinor-600 hover:bg-vinor-700 text-white font-semibold">
            ثبت آگهی
          </button>
        </div>
      </form>
      <p class="mt-2 text-xs text-gray-500 dark:text-gray-400">در وینور، کد آگهی به‌صورت خودکار و یکتا تولید می‌شود.</p>
    </section>
  </main>

  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>
