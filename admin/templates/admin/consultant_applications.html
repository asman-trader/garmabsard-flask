{% extends 'admin/base_admin.html' %}
{% block title %}درخواست‌های مشاورین | پنل مدیریت{% endblock %}
{% block page_title %}
<h1 class="text-xl sm:text-2xl font-extrabold tracking-tight text-vinor-700 dark:text-green-400 flex items-center gap-2">
  <i class="fas fa-user-tie"></i>
  درخواست‌های مشاورین
{% endblock %}
{% block content %}
<div class="bg-white dark:bg-gray-800 rounded-xl border dark:border-gray-700 overflow-hidden">
  <table class="w-full text-sm">
    <thead class="bg-gray-50 dark:bg-gray-900/40">
      <tr class="text-right text-gray-700 dark:text-gray-300">
        <th class="p-3">#</th>
        <th class="p-3">نام</th>
        <th class="p-3">شماره</th>
        <th class="p-3">شهر</th>
        <th class="p-3">سابقه</th>
        <th class="p-3">وضعیت</th>
        <th class="p-3">تاریخ</th>
        <th class="p-3">اقدامات</th>
      </tr>
    </thead>
    <tbody>
      {% for a in items %}
      <tr class="border-t dark:border-gray-700" data-row-id="{{ a.id }}">
        <td class="p-3">{{ a.id }}</td>
        <td class="p-3">{{ a.name or '—' }}</td>
        <td class="p-3">{{ a.phone or '—' }}</td>
        <td class="p-3">{{ a.city or '—' }}</td>
        <td class="p-3">{{ a.experience or '—' }}</td>
        <td class="p-3" data-status>{{ a.status or 'new' }}</td>
        <td class="p-3"><span class="jalali-dt" data-dt="{{ a.created_at or '' }}"></span></td>
        <td class="p-3">
          <div class="flex items-center gap-2">
            <form method="post" action="{{ url_for('admin.consultant_application_approve', aid=a.id) }}" class="contents" x-data data-ajax="1">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" @click.prevent="if(confirm('تأیید این درخواست؟')) $el.closest('form').submit()"
                      class="px-3 py-1 rounded-md bg-emerald-600 text-white hover:bg-emerald-700">تأیید</button>
            </form>
            <form method="post" action="{{ url_for('admin.consultant_application_reject', aid=a.id) }}" class="contents" x-data data-ajax="1">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" @click.prevent="if(confirm('رد این درخواست؟')) $el.closest('form').submit()"
                      class="px-3 py-1 rounded-md bg-rose-600 text-white hover:bg-rose-700">رد</button>
            </form>
          </div>
        </td>
      </tr>
      {% else %}
      <tr><td class="p-3 text-center text-gray-500" colspan="8">موردی یافت نشد.</td></tr>
      {% endfor %}
    </tbody>
 </table>

<script>
(function(){
  function fmt(dt){
    try{
      const d = new Date(String(dt||'').replace(' ','T'));
      if (isNaN(d)) return '';
      return d.toLocaleString('fa-IR', { timeZone: 'Asia/Tehran', year:'numeric', month:'2-digit', day:'2-digit', hour:'2-digit', minute:'2-digit' });
    }catch(_){ return ''; }
  }
  document.querySelectorAll('.jalali-dt[data-dt]').forEach(el=>{
    const raw = el.getAttribute('data-dt')||'';
    el.textContent = fmt(raw) || '—';
  });
})();
</script>
}</div>
{% endblock %}

