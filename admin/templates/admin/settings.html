{% extends "admin/base_admin.html" %}
{% block content %}
<div class="p-4 sm:p-6">

  <!-- عنوان صفحه -->
  <h1 class="text-xl sm:text-2xl font-bold text-vinor-700 dark:text-vinor-600 mb-6 flex items-center gap-2">
    <i class="fas fa-sliders-h"></i>
    تنظیمات سایت
  </h1>

  <!-- پیام‌ها -->
  {% with messages = get_flashed_messages(with_categories=True) %}
    {% if messages %}
      {% for category, msg in messages %}
        <div class="mb-4 text-sm rounded-lg px-3 py-2
                    {% if category in ['success'] %}bg-green-50 text-green-700 dark:bg-green-900/40 dark:text-green-200
                    {% elif category in ['warning'] %}bg-yellow-50 text-yellow-700 dark:bg-yellow-900/40 dark:text-yellow-200
                    {% elif category in ['info'] %}bg-blue-50 text-blue-700 dark:bg-blue-900/40 dark:text-blue-200
                    {% else %}bg-red-50 text-red-700 dark:bg-red-900/40 dark:text-red-200{% endif %}">
          {{ msg }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- فرم تنظیمات -->
  <form method="post"
        action="{{ url_for('admin.settings') }}"
        class="bg-white dark:bg-gray-800 shadow rounded-xl border border-gray-200 dark:border-gray-700 px-4 sm:px-6 py-5 space-y-5"
        autocomplete="off">
    <!-- CSRF -->
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

    <!-- روش تایید آگهی‌ها -->
    <div class="space-y-2">
      <label for="approval_method" class="block text-sm font-semibold text-gray-700 dark:text-gray-200">
        روش تأیید آگهی‌ها
      </label>
      <select id="approval_method" name="approval_method"
              class="block w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600
                     text-gray-800 dark:text-gray-100 rounded-lg px-3 py-2
                     focus:outline-none focus:ring-2 focus:ring-vinor-600 focus:border-transparent">
        <option value="manual" {% if settings.approval_method == 'manual' %}selected{% endif %}>تأیید دستی</option>
        <option value="auto" {% if settings.approval_method == 'auto' %}selected{% endif %}>تأیید خودکار</option>
      </select>
      <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
        در حالت «تأیید خودکار»، آگهی‌ها بلافاصله پس از ارسال منتشر می‌شوند.
      </p>
    </div>

    <!-- نمایش دکمه ثبت آگهی -->
    <div class="space-y-2">
      <label class="flex items-center gap-2 text-sm font-semibold text-gray-700 dark:text-gray-200">
        <input type="checkbox" name="show_submit_button" class="rounded border-gray-300 dark:border-gray-600"
               {% if settings.show_submit_button %}checked{% endif %}>
        نمایش دکمه «ثبت آگهی جدید» در سایت
      </label>
      <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
        با غیرفعال‌کردن، میانبرهای «+ ثبت آگهی» در هدر، فوتر موبایل و جستجوی سریع مخفی می‌شوند.
      </p>
    </div>

<!-- مدت اعتبار آگهی -->
<div class="space-y-2">
  <label for="ad_expiry_days" class="block text-sm font-semibold text-gray-700 dark:text-gray-200">
    مدت اعتبار آگهی
  </label>

  <select id="ad_expiry_days" name="ad_expiry_days"
          class="block w-full bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600
                 text-gray-800 dark:text-gray-100 rounded-lg px-3 py-2
                 focus:outline-none focus:ring-2 focus:ring-vinor-600 focus:border-transparent">
    <option value="0"  {% if (settings.ad_expiry_days|int) == 0 %}selected{% endif %}>نامحدود</option>
    <option value="30" {% if (settings.ad_expiry_days|int) == 30 %}selected{% endif %}>۳۰ روز</option>
    <option value="60" {% if (settings.ad_expiry_days|int) == 60 %}selected{% endif %}>۶۰ روز</option>
    <option value="90" {% if (settings.ad_expiry_days|int) == 90 %}selected{% endif %}>۹۰ روز</option>
  </select>

  <p class="text-xs sm:text-sm text-gray-500 dark:text-gray-400">
    اگر «نامحدود» را انتخاب کنید، آگهی تاریخ انقضا نخواهد داشت و حذف خودکار نمی‌شود.
  </p>
</div>


    <div class="flex items-center justify-end">
      <button type="submit"
              class="inline-flex items-center gap-2 bg-vinor-600 hover:bg-vinor-700 text-white
                     font-semibold text-sm sm:text-base px-5 py-2.5 rounded-lg transition">
        <i class="fas fa-save"></i>
        ذخیره تنظیمات
      </button>
    </div>
  </form>
</div>
{% endblock %}
